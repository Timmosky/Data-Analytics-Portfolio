dax-----------------------------
Normal_Rate = 
VAR Qty = parts[Weekly_Qty_Ordered]  /* Or your quantity column name */
VAR SysCount = parts[System_Count]    /* Your system count column */

RETURN
IF(
    NOT ISBLANK(SysCount) && SysCount > 0,
    DIVIDE(Qty, SysCount, 0),
    BLANK()
)

----------------

TrailingUpperLimit = 
VAR LookbackWeeks = 8
VAR Multiplier = 1.5  /* Adjust for sensitivity: 1.5 = more alerts, 2.0 = fewer alerts */

VAR CurrentWeek = parts[Order Fiscal Week]
VAR CurrentItem = parts[Item Description]
VAR CurrentFamily = parts[Ultimate_family_name]

/* Get max date for current week */
VAR CurrentMaxDate = 
    MAXX(
        FILTER(
            parts,
            parts[Order Fiscal Week] = CurrentWeek
            && parts[Item Description] = CurrentItem
            && parts[Ultimate_family_name] = CurrentFamily
        ),
        parts[Order Date]
    )

/* Define lookback window (BEFORE current week) */
VAR StartDate = CurrentMaxDate - (LookbackWeeks * 7)
VAR EndDate = CurrentMaxDate - 1  /* Exclude current week */

/* Get prior weeks data */
VAR PriorWeeksData = 
    FILTER(
        parts,
        parts[Item Description] = CurrentItem
        && parts[Ultimate_family_name] = CurrentFamily
        && parts[Order Date] >= StartDate
        && parts[Order Date] <= EndDate
        && parts[Order Fiscal Week] <> CurrentWeek
        && NOT ISBLANK(parts[Normal_Rate])
    )

/* Calculate statistics */
VAR Mean = AVERAGEX(PriorWeeksData, parts[Normal_Rate])
VAR StdDev = STDEVX.P(PriorWeeksData, parts[Normal_Rate])

/* Handle edge cases */
VAR SafeStdDev = 
    IF(
        ISBLANK(StdDev) || StdDev = 0,
        Mean * 0.3,  /* Fallback: 30% of mean */
        StdDev
    )

/* Calculate upper limit */
RETURN
IF(
    NOT ISBLANK(Mean),
    Mean + (Multiplier * SafeStdDev),
    BLANK()
)
--------------------------------------------------------------
TrailingAnomaly = 
VAR CurrentRate = parts[Normal_Rate]
VAR UpperLimit = parts[TrailingUpperLimit]

RETURN
IF(
    NOT ISBLANK(UpperLimit) && CurrentRate > UpperLimit,
    1,
    0
)

------------------------------------------------

Exceedance_8Week = 
VAR CurrentWeek = parts[Order Fiscal Week]
VAR CurrentItem = parts[Item Description]
VAR CurrentFamily = parts[Ultimate_family_name]
VAR IsAnomaly = parts[TrailingAnomaly] = 1

RETURN
IF(
    IsAnomaly,
    
    /* Find last non-anomaly week before current */
    VAR LastNonAnomalyWeek = 
        MAXX(
            FILTER(
                parts,
                parts[Item Description] = CurrentItem
                && parts[Ultimate_family_name] = CurrentFamily
                && parts[Order Fiscal Week] < CurrentWeek
                && parts[TrailingAnomaly] = 0
            ),
            parts[Order Fiscal Week]
        )
    
    /* Set streak start (0 if never had a gap) */
    VAR StreakStart = IF(ISBLANK(LastNonAnomalyWeek), 0, LastNonAnomalyWeek)
    
    /* Count consecutive anomaly weeks */
    VAR StreakLength = 
        COUNTROWS(
            FILTER(
                parts,
                parts[Item Description] = CurrentItem
                && parts[Ultimate_family_name] = CurrentFamily
                && parts[Order Fiscal Week] > StreakStart
                && parts[Order Fiscal Week] <= CurrentWeek
                && parts[TrailingAnomaly] = 1
            )
        )
    
    RETURN StreakLength,
    
    BLANK()
)


system_count = VAR part_famly = SELECTEDVALUE(parts[Ultimate_family_name])
VAR  part_year = SELECTEDVALUE(parts[Order Year])
VAR exp_pro = SELECTEDVALUE('Export'[New_PSI_description])
VAR exp_year= SELECTEDVALUE('Export'[Year])
VAR part_quarte = SELECTEDVALUE(parts[numericquarter])
RETURN
CALCULATE(AVERAGE('Export'[Value]), 'Export'[New_PSI_description] = part_famly, 'Export'[Year] = part_year, 'Export'[Quarter_Date] = part_quarte, KEEPFILTERS(VALUES(DateTable[Year])), REMOVEFILTERS(parts[Order Fiscal Week]))
